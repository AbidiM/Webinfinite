<div class="row">
    <div class="col-19">
        <div class="card">
            <div class="card-body ">
              <form  [formGroup]="merchantForm"  class="m-4">
                <div *ngIf="formError" class="alert alert-danger">{{ formError }}</div>
                <div class="row">

                  <div class="col-md-6 mb-3">
                    <div class="form-group ">
                    <label for="merchantName" >Merchant Name <span *ngIf="type !== 'view'" class="text-danger">*</span></label>
                    <input type="text" id="merchantName" class="form-control" formControlName="merchantName" placeholder="{{ 'Enter merchant name' | translate }}" required [readonly]="type==='view'">
                    <div *ngIf="merchantForm.get('merchantName').touched && merchantForm.get('merchantName').invalid" class="invalid-feedback d-block">
                      <span *ngIf="merchantForm.get('merchantName').errors?.['required']">{{'Merchant Name is required'| translate}}.</span>
                    </div>  
                  </div>
                </div>

                  <div class="col-md-6 mb-3">
                    <div class="form-group ">
                       
                        <label for="username" >{{'Username' | translate}} <span *ngIf="type !== 'view'" class="text-danger">*</span></label>
                        <input type="text" id="username" class="form-control" formControlName="username" placeholder="{{ 'Enter username' | translate }}" required [readonly]="type==='view'">
                        <div *ngIf="merchantForm.get('username').touched && merchantForm.get('username').invalid" class="invalid-feedback d-block">
                            <span *ngIf="merchantForm.get('username').errors?.['required']">{{'Username is required'| translate}}.</span>
                          </div>
                      </div> 
                  </div>

                  <div class="col-md-6 mb-3">
                    <div class="form-group ">
                      <label for="email">Email <span *ngIf="type !== 'view'" class="text-danger">*</span></label>
                      <input  type="email" id="email" class="form-control" formControlName="email" placeholder="{{ 'Enter email address' | translate }}" required [readonly]="type==='view'">
                      <div *ngIf="merchantForm.get('email').touched && merchantForm.get('email').invalid" class="invalid-feedback d-block">
                        <span *ngIf="merchantForm.get('email').errors?.['required']">{{'Email is required'| translate}}.</span>
                      </div>
                    </div>
                  </div>
               
                  <div class="col-md-6 mb-3">
                      <div class="form-group ">
                        <label for="id_number" >{{'ID Number' | translate}} <span *ngIf="type !== 'view'" class="text-danger">*</span></label>
                        <input type="text" id="id_number" class="form-control" formControlName="id_number" placeholder="{{ 'Enter ID number' | translate }}" required [readonly]="type==='view'">
                        <div *ngIf="merchantForm.get('id_number').touched && merchantForm.get('id_number').invalid" class="invalid-feedback d-block">
                            <span *ngIf="merchantForm.get('id_number').errors?.['required']">{{'id_number is required'| translate}}.</span>
                          </div>
                    </div>
                  </div>
              
                  <div *ngIf="type == 'create'" class="col-md-6 mb-3">
                    <div class="form-group ">
                        <div class="form-group ">
                          <label for="password" >Password <span *ngIf="type !== 'view'" class="text-danger">*</span></label>
                          <div class="input-group auth-pass-inputgroup">
                          <input [type]="fieldTextType ? 'text' : 'password'" id="password" class="form-control" placeholder="{{ 'Enter password' | translate }}" formControlName="password" required>
                          <button class="btn btn-light ms-0" type="button" id="password-addon">
                            <i class="mdi mdi-eye-outline" [ngClass]="{'mdi-eye-off-outline': !fieldTextType, 'mdi-eye-outline': fieldTextType}" (click)="toggleFieldTextType()"></i>
                          </button>
                          <div *ngIf="merchantForm.get('password').touched && merchantForm.get('password').invalid" class="invalid-feedback d-block">
                            <span *ngIf="merchantForm.get('password').errors?.['required']">{{'Password is required'| translate}}.</span>
                          </div>
                          </div>
                        </div>
                    </div>
                    </div>

                  <div *ngIf="type == 'create'" class="col-md-6 mb-3">
                      <div class="form-group ">
                        <div class="form-group ">
                          <label for="confpassword" >Confirm password <span *ngIf="type !== 'view'" class="text-danger">*</span></label>
                          <div class="input-group auth-pass-inputgroup">
                          <input [type]="fieldTextType ? 'text' : 'password'" id="confpassword" class="form-control" placeholder="{{ 'Re-enter password' | translate }}" formControlName="confpassword" required>
                          <button class="btn btn-light ms-0" type="button" id="password-addon">
                            <i class="mdi mdi-eye-outline" [ngClass]="{'mdi-eye-off-outline': !fieldTextType, 'mdi-eye-outline': fieldTextType}" (click)="toggleFieldTextType()"></i>
                          </button>
                          <div *ngIf="merchantForm.get('confpassword').touched && merchantForm.get('confpassword').invalid" class="invalid-feedback d-block">
                            <span *ngIf="merchantForm.get('confpassword').errors?.['required']">{{'Confirm password is required' | translate}}.</span>
                            <div *ngIf="passwordMatchError">{{ 'confirm_password_does_not_matched' | translate }}</div>
                          </div>
                          </div>
                      </div>
                    </div>
                  </div>
                  
                    
                    <div class="col-md-6 mb-3">
                      <div class="form-group">
                        <label for="phone" >Phone Number <span *ngIf="type !== 'view'" class="text-danger">*</span></label><br>
                       <app-phone-number
                       [disabled]="type === 'view'"
                       [initialPhoneNumber]="merchantForm.get('phone').value"
                       [inputId]="'phone'"
                       *ngIf="merchantForm"
                        (phoneNumberChanged)="onPhoneNumberChanged($event)" >
                      </app-phone-number>
                       <div *ngIf="merchantForm.get('phone').touched && merchantForm.get('phone').invalid" class="invalid-feedback d-block">
                        <span *ngIf="merchantForm.get('phone').errors?.['required']">{{'Phone Number is required'| translate}}.</span>
                      </div>   
                      </div>
                    </div>
                    <div class="col-md-6 mb-3">
                      <div class="form-group">
                        <label for="section_id">Merchant Section</label>
                        <input *ngIf="type === 'view'"
                          type="text" 
                          class="form-control" 
                          [value]="getSectionName(merchantForm.get('section_id').value)" 
                          readonly 
                        />
                        <select [hidden]="type === 'view'" id="section_id" class="form-control" formControlName="section_id">
                          <option value="">{{'Select a section' | translate}}</option>
                          <option *ngFor="let section of sectionlist" [value]="section.id">
                            {{ section.name }}
                          </option>
                        </select>
                      </div>
                    </div>
                 
                    <div class="col-md-6 mb-3">
                      <div class="form-group">
                        <label for="merchantLogo">{{ 'Merchant Logo' | translate }}</label>
                    
                        <!-- Display the merchant logo if it exists -->
                        <div *ngIf="merchantForm.get('merchantLogo').value !== null && merchantForm.get('merchantLogo').value !== ''"
                        class="mb-3">
                          <img [src]="existantmerchantLogo" alt="Merchant Logo" class="img-fluid" width="200">
                        </div>
                        <input
                        type="text"
                        class="form-control-plaintext"
                        [value]="fileName1" 
                        readonly
                      >
                        <!-- File input for selecting or uploading a new image -->
                        <input
                          type="file"
                          [disabled]="type==='view'"
                          id="merchantLogo"
                          class="form-control"
                          accept="image/png, image/gif, image/jpeg"
                          (change)="uploadMerchantLogo($event)"
                        >
                      </div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <div class="form-group">
                        <label for="merchantPicture">{{'Merchant Picture' | translate}}</label>
                         <!-- Display the merchant pictures if it exists -->
                         <div *ngIf="merchantForm.get('merchantPicture').value !== null && merchantForm.get('merchantPicture').value !== ''"
                         class="mb-3">
                           <img [src]="existantmerchantPicture" alt="Merchant Pictutre" class="img-fluid" width="200">
                         </div>
                         <input
                         type="text"
                         class="form-control-plaintext"
                         [value]="fileName2" 
                         readonly
                       >
                      <input 
                        type="file" 
                        [disabled]="type==='view'"
                        id="merchantPicture" 
                        class="form-control"  
                        accept="image/png, image/gif, image/jpeg" 
                        (change)="uploadMerchantPicture($event)">
                      </div>
                    </div>
                
                  <div class="col-md-6 mb-3">
                    <div class="form-group">
                      <label for="country_id" >Country</label>
                      <input *ngIf="type === 'view'"
                      type="text" 
                      class="form-control" 
                      [value]="getCountryName(merchantForm.get('country_id').value)" 
                      readonly 
                  />
                      <select [hidden]="type === 'view'" id="country_id"class="form-control"  formControlName="country_id" (change)="onChangeCountrySelection($event)" >
                        <option value="" disabled selected>{{'Select_the_Country' | translate}}</option>
                        <option *ngFor="let country of countrylist" [value]="country.id">
                         {{ country.name }}
                       </option>
                      </select>  
                    </div>
                  </div>
                  
                    <div class="col-md-6 mb-3">
                      <div class="form-group">
                        <label for="area_id">Area</label>
                        <input *ngIf="type === 'view'"
                          type="text" 
                          class="form-control" 
                          [value]="getAreaName(merchantForm.get('area_id').value)" 
                          readonly 
                      />
                        <select  [hidden]="type === 'view'" id="area_id"class="form-control"  formControlName="area_id" (change)="onChangeAreaSelection($event)" >
                          <option value="" disabled selected>{{'Select_the_Area' | translate}}</option>
                          <option *ngFor="let area of filteredAreas" [value]="area.id">
                           {{ area.name }}
                         </option>
                        </select>                         
                      </div>
                    </div>

                  <div class="col-md-6 mb-3">
                    <div class="form-group ">
                      <label for="city_id" >City</label>
                      <input *ngIf="type === 'view'"
                      type="text" 
                      class="form-control" 
                      [value]="getCityName(merchantForm.get('city_id').value)" 
                      readonly 
                  />
                      <select [hidden]="type === 'view'" id="city_id"class="form-control"  formControlName="city_id"  >
                        <option value="" disabled selected>{{'Select_the_City' | translate}}</option>
                        <option *ngFor="let city of filteredCities" [value]="city.id">
                         {{ city.name }}
                       </option>
                      </select>                      
                    </div>
                  </div>
              
               
                  <div class="col-md-6 mb-3">
                    <div class="form-group">
                      <label for="serviceType">Service Type</label>
                      <input type="text" id="serviceType" class="form-control" formControlName="serviceType" placeholder="{{ 'Enter service type' | translate }}" [readonly]="type==='view'">
                    </div>
                  </div>
               
                  <div class="col-md-6 mb-3">
                    <div class="form-group">
                      <label for="supervisorName">Supervisor Name</label>
                      <input type="text" id="supervisorName" class="form-control" placeholder="{{ 'Enter supervisor name' | translate }}" formControlName="supervisorName" [readonly]="type==='view'">
                    </div>
                  </div>
                  <div class="col-md-6 mb-3">
                    <div class="form-group">
                      <label for="supervisorPhone">Supervisor Phone</label><br>
                      <app-phone-number
                      [initialPhoneNumber]="merchantForm.get('supervisorPhone').value"
                      [disabled]="type === 'view'"
                      *ngIf="merchantForm"
                      [inputId]="'supervisorPhone'"
                      (phoneNumberChanged)="onSupervisorPhoneChanged($event)" >
                     </app-phone-number>                       
                    </div>
                  </div>
                
                  <div class="col-md-6 mb-3">
                    <div class="form-group">
                      <label for="bankAccountNumber">Bank Account Number</label>
                      <input type="text" id="bankAccountNumber" class="form-control" placeholder="{{ 'Enter Bank Account Number' | translate }}" formControlName="bankAccountNumber" [readonly]="type==='view'">
                    </div>
                  </div>

                  
                  <div class="col-md-6 mb-3">
                    <div class="form-group">
                      <label for="website">Merchant Website</label>
                      <input type="text" id="website" class="form-control" formControlName="website" placeholder="https://example.com" [readonly]="type==='view'">
                    </div>
                  </div>
               
            
              
                <div class="col-md-6 mb-3">
                  <div class="form-group">
                    <label for="whatsup">WhatsApp</label>
                    <input type="text" id="whatsup" class="form-control" formControlName="whatsup" placeholder="+1234567890" [readonly]="type==='view'">
                  </div>
                </div>
               
            
                <div class="col-md-6 mb-3">
                  <div class="form-group">
                    <label for="facebook">Facebook</label>
                    <input type="text" id="facebook" class="form-control" formControlName="facebook" placeholder="facebook.com/yourpage" [readonly]="type==='view'">
                  </div>
                </div>
              
                <div class="col-md-6 mb-3">
                  <div class="form-group">
                    <label for="twitter">Twitter</label>
                    <input type="text" id="twitter" class="form-control" formControlName="twitter" placeholder="twitter.com/yourhandle" [readonly]="type==='view'">
                  </div>
                </div>
                
                <div class="col-md-6 mb-3">
                  <div class="form-group">
                    <label for="instagram">Instagram</label>
                    <input type="text" id="instagram" class="form-control" formControlName="instagram" placeholder="instagram.com/yourprofile" [readonly]="type==='view'">
                  </div>
                </div>
                    
                  </div>
                <div class="col-12  mt-4">
                    <div class="d-flex justify-content-end">
                      <div class="d-flex justify-content-end">
                        <ng-container *ngIf="type =='view'; else editModeButtons">
                          <button type="button" class="btn btn-success" (click)="toggleViewMode()">{{ 'Go_Back' | translate }}</button>
                        </ng-container>
                        <ng-template #editModeButtons>
                          <button type="button" id="cancel-btn" class="btn btn-outline-secondary me-2" (click)="onCancel()">{{ 'Cancel' | translate }}</button>
                          <button type="submit" class="btn btn-success" (click)="onSubmit()">{{ (type === 'create' ? 'Add_merchant' : 'update_merchant') | translate }}</button>
                          <div id="elmLoader" class="loader" *ngIf="loading$ | async">
                            <div class="spinner-border text-primary avatar-sm" role="status">
                              <span class="visually-hidden">Loading...</span>
                            </div>
                          </div>   
                        </ng-template>
                      </div>
                    </div>
                </div>
              </form>
            </div>
        </div>
    </div> <!-- end col -->
  </div>
  